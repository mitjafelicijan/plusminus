# PlusMinus - Tiny X11 Window Manager

PlusMinus is a minimal X11 window manager that provides essential window management functionality through keyboard shortcuts and window operations. Built with simplicity and efficiency in mind, it offers a lightweight alternative to heavyweight desktop environments while maintaining full control over window management.

## Key Features

- **Window Movement**: Precise pixel-by-pixel window positioning
- **Window Resizing**: Incremental resizing with minimum size constraints
- **Desktop Management**: Multi-desktop support with window movement between desktops
- **Window Control**: Force kill and fullscreen toggle capabilities
- **Smart Maximization**: Separate vertical and horizontal maximization with state tracking
- **Edge Snapping**: Quick window positioning to screen edges
- **Comprehensive Logging**: Debug logging for all operations
- **Safety Checks**: Window existence validation and boundary checking

## Technical Details

- Built on X11/Xlib for low-level window management
- Uses EWMH (Extended Window Manager Hints) for fullscreen functionality
- Maintains state for maximized windows to enable toggle behavior
- Implements proper X11 event handling and window attribute management
- Includes comprehensive error checking and logging throughout

## Requirements

- C compiler (GCC or Clang)
- GNU Make
- pkg-config
- X11 and Freetype development libraries

### Installing Dependencies

**Void Linux:**
```sh
sudo xbps-install libX11-devel freetype-devel
```

**Ubuntu/Debian:**
```sh
sudo apt install libx11-dev libxft-dev pkg-config
```

**Arch Linux:**
```sh
sudo pacman -S libx11 libxft pkg-config
```

**Fedora/RHEL:**
```sh
sudo dnf install libX11-devel libXft-devel pkg-config
```

**For testing (optional):**
```sh
# Void Linux
sudo xbps-install xephyr

# Ubuntu/Debian
sudo apt install xserver-xephyr

# Arch Linux
sudo pacman -S xorg-server-xephyr
```

## Compilation

```sh
# Build normally without optimizations and without debug symbols.
make

# Use a specific compiler
CC=clang make
CC=gcc make

# Build with debug symbols (includes -ggdb -DDEBUG)
DEBUG=1 make

# Compile with optimization levels
OPTIMIZE=1 make  # -O1
OPTIMIZE=2 make  # -O2
OPTIMIZE=3 make  # -O3

# Combine options
DEBUG=1 OPTIMIZE=2 CC=clang make

# Clean build
make clean && make
```

### Testing in Virtual Display

For safe testing without affecting your main session:

```sh
# Start Xephyr virtual display (from Makefile)
make virt

# In another terminal, run the window manager in the virtual display
DISPLAY=:69 ./plusminus
```

## Installation

After successful compilation, you have several options for installing and running PlusMinus:

### Option 1: Run from Current Directory
```sh
# Simply run the binary
./plusminus
```

## Running PlusMinus

### Starting the Window Manager

**From a display manager (login screen):**
- Add PlusMinus to your display manager's session list
- Select it from the session menu

**From a terminal (if already in X11):**
```sh
# Exit current window manager first, then:
./plusminus
```

**From a TTY (text console):**
```sh
# Start X server and window manager
startx ./plusminus
```

### Stopping PlusMinus

- **Graceful exit:** Use your configured quit key binding (default: `Alt+q`)
- **Force quit:** `Ctrl+Alt+F1` to switch to TTY, then `pkill plusminus`
- **Emergency:** `Ctrl+Alt+Backspace` (if enabled in X server)

## Configuration

PlusMinus uses a simple configuration system based on C header files. The configuration is compiled into the binary, so you need to recompile after making changes.

### Setting Up Configuration

1. **Copy the default configuration**:
   ```sh
   cp config.def.h config.h
   ```

2. **Edit your configuration**:
   ```sh
   nano config.h  # or your preferred editor
   ```

3. **Recompile the window manager**:
   ```sh
   make clean && make
   ```

4. **Restart the window manager** to apply changes

### Configuration Files

- **`config.def.h`** - Default configuration template (do not edit this file)
- **`config.h`** - Your personal configuration (edit this file)

The `config.def.h` file contains the default settings and serves as a template. Always copy it to `config.h` before making changes, as the build system will overwrite `config.h` if it doesn't exist.

### Configuration Structure

The configuration uses two main arrays:

1. **`shortcuts[]`** - Maps keys to shell commands
2. **`keybinds[]`** - Maps keys to window manager functions

### Default Key Bindings

#### Window Movement
```c
{ MODKEY,               XK_Left,    move_window_x,       { .i = -50 } },  // Move left 50px
{ MODKEY,               XK_Right,   move_window_x,       { .i = +50 } },  // Move right 50px
{ MODKEY,               XK_Up,      move_window_y,       { .i = -50 } },  // Move up 50px
{ MODKEY,               XK_Down,    move_window_y,       { .i = +50 } },  // Move down 50px
```

#### Window Resizing
```c
{ MODKEY | ShiftMask,   XK_Left,    resize_window_x,     { .i = -50 } },  // Shrink width 50px
{ MODKEY | ShiftMask,   XK_Right,   resize_window_x,     { .i = +50 } },  // Expand width 50px
{ MODKEY | ShiftMask,   XK_Up,      resize_window_y,     { .i = -50 } },  // Shrink height 50px
{ MODKEY | ShiftMask,   XK_Down,    resize_window_y,     { .i = +50 } },  // Expand height 50px
```

#### Desktop Management
```c
// Switch to desktop
{ MODKEY,               XK_1,       switch_to_desktop,   { .i = 1 } },
{ MODKEY,               XK_2,       switch_to_desktop,   { .i = 2 } },
// ... up to XK_9 for desktop 9

// Move window to desktop
{ MODKEY | ControlMask, XK_1,       move_to_desktop,     { .i = 1 } },
{ MODKEY | ControlMask, XK_2,       move_to_desktop,     { .i = 2 } },
// ... up to XK_9 for desktop 9
```

#### Window Control
```c
{ MODKEY,               XK_f,       fullscreen,          { 0 } },         // Toggle fullscreen
{ MODKEY,               XK_q,       kill_window,         { 0 } },         // Kill window
```

#### Window Maximization
```c
{ MODKEY,               XK_x,       window_hmaximize,    { 0 } },         // Horizontal maximize
{ MODKEY,               XK_z,       window_vmaximize,    { 0 } },         // Vertical maximize
```

#### Window Snapping
```c
{ MODKEY | ControlMask, XK_Up,      window_snap_up,      { 0 } },         // Snap to top
{ MODKEY | ControlMask, XK_Down,    window_snap_down,    { 0 } },         // Snap to bottom
{ MODKEY | ControlMask, XK_Right,   window_snap_right,   { 0 } },         // Snap to right
{ MODKEY | ControlMask, XK_Left,    window_snap_left,    { 0 } },         // Snap to left
```

### Key Modifiers

- **`MODKEY`** - Default modifier key (Alt key in config.h, Super key in config.def.h)
- **`ShiftMask`** - Shift key modifier
- **`ControlMask`** - Ctrl key modifier

### Configuration Examples

#### Custom Movement Distance
```c
// Move window by 100 pixels instead of 50
{ MODKEY,               XK_Left,    move_window_x,       { .i = -100 } },
{ MODKEY,               XK_Right,   move_window_x,       { .i = +100 } },
```

#### Different Key Bindings
```c
// Use 'h' and 'l' for horizontal movement (vim-style)
{ MODKEY,               XK_h,       move_window_x,       { .i = -50 } },
{ MODKEY,               XK_l,       move_window_x,       { .i = +50 } },

// Use 'j' and 'k' for vertical movement (vim-style)
{ MODKEY,               XK_j,       move_window_y,       { .i = +50 } },
{ MODKEY,               XK_k,       move_window_y,       { .i = -50 } },
```

#### Custom Desktop Numbers
```c
// Switch to desktop 10
{ MODKEY,               XK_0,       switch_to_desktop,   { .i = 10 } },

// Move to desktop 0 (all desktops)
{ MODKEY | ControlMask, XK_0,       move_to_desktop,     { .i = 0 } },
```

### Shell Commands Integration

The `shortcuts[]` array allows binding keys to shell commands:

```c
static Shortcut shortcuts[] = {
    { MODKEY,               XK_Return,                "st" },                    // Open terminal
    { MODKEY,               XK_e,                     "firefox" },               // Open browser
    { MODKEY,               XK_p,                     "rofi -show drun" },       // Application launcher
    { 0,                    XF86XK_AudioLowerVolume,  "pactl set-sink-volume @DEFAULT_SINK@ -5%" },
    { 0,                    XF86XK_AudioRaiseVolume,  "pactl set-sink-volume @DEFAULT_SINK@ +5%" },
};
```

### Configuration Tips

1. **Movement/Resize Values**: The `.i` value determines how many pixels to move/resize. Adjust based on your screen size and preference.

2. **Modifier Keys**: Use different modifier combinations to avoid conflicts:
   - `MODKEY` alone for basic operations
   - `MODKEY | ShiftMask` for resize operations
   - `MODKEY | ControlMask` for desktop operations

3. **Key Symbols**: Use standard X11 keysym names (XK_Left, XK_Right, etc.) or custom keys (XK_h, XK_j, etc.)

4. **Function Arguments**: 
   - Use `{ .i = value }` for integer arguments (movement distance, desktop number)
   - Use `{ 0 }` for functions that don't need arguments

### Configuration Variables

The configuration file also contains several variables you can customize:

```c
#define MODKEY Mod1Mask                    // Modifier key (Alt key)
static const char *font_name = "Berkeley Mono:style=Bold:pixelsize=16:antialias=true:autohint=true";
static int border_size = 3;                // Window border width in pixels
static const char *active_border_color = "khaki";      // Active window border color
static const char *inactive_border_color = "darkgray"; // Inactive window border color
static const char *time_format = "%A %d.%m.%Y %H:%M:%S"; // Time display format
static bool follow_focus = false;          // Enable auto-focus on mouse enter (true/false)
```

### Common Configuration Tasks

#### Changing the Modifier Key
```c
// Use Super key (Windows key) instead of Alt
#define MODKEY Mod4Mask

// Use Ctrl key instead of Alt
#define MODKEY ControlMask
```

#### Customizing Window Appearance
```c
// Thicker borders
static int border_size = 5;

// Different colors
static const char *active_border_color = "red";
static const char *inactive_border_color = "blue";

// Different font
static const char *font_name = "DejaVu Sans Mono:pixelsize=14";
```

#### Auto-Focus Behavior
```c
// Enable auto-focus when mouse enters a window
static bool follow_focus = true;

// Disable auto-focus (default behavior)
static bool follow_focus = false;
```

When `follow_focus` is enabled, windows will automatically gain focus and be raised when you move your mouse over them. This can be convenient but may be distracting if you prefer manual window activation.

#### Adding Custom Applications
```c
static Shortcut shortcuts[] = {
    { MODKEY,               XK_Return,                "alacritty" },           // Different terminal
    { MODKEY,               XK_b,                     "firefox" },             // Browser
    { MODKEY,               XK_f,                     "thunar" },              // File manager
    { MODKEY,               XK_c,                     "code" },                // Code editor
    { MODKEY,               XK_m,                     "thunderbird" },         // Email client
    // ... existing shortcuts
};
```

#### Vim-Style Key Bindings
```c
static Keybinds keybinds[] = {
    // Vim-style movement
    { MODKEY,               XK_h,       move_window_x,       { .i = -50 } },
    { MODKEY,               XK_l,       move_window_x,       { .i = +50 } },
    { MODKEY,               XK_j,       move_window_y,       { .i = +50 } },
    { MODKEY,               XK_k,       move_window_y,       { .i = -50 } },
    
    // Vim-style resizing
    { MODKEY | ShiftMask,   XK_h,       resize_window_x,     { .i = -50 } },
    { MODKEY | ShiftMask,   XK_l,       resize_window_x,     { .i = +50 } },
    { MODKEY | ShiftMask,   XK_j,       resize_window_y,     { .i = +50 } },
    { MODKEY | ShiftMask,   XK_k,       resize_window_y,     { .i = -50 } },
    
    // ... other bindings
};
```

### Configuration Workflow

1. **Make a backup** of your working config:
   ```sh
   cp config.h config.h.backup
   ```

2. **Test changes incrementally** - make small changes and test them before adding more

3. **Use version control** to track your configuration:
   ```sh
   git add config.h
   git commit -m "Update window manager configuration"
   ```

4. **Share configurations** - you can easily share your `config.h` file with others

### Troubleshooting Configuration

- **Build errors**: Check for syntax errors in your `config.h` file
- **Key conflicts**: Make sure you don't have duplicate key bindings
- **Missing applications**: Ensure applications in shortcuts exist in your PATH
- **Invalid colors**: Use standard X11 color names or hex codes
- **Font issues**: Verify font names with `fc-list` command

### Example Complete Configuration

Here's an example of a customized configuration:

```c
#define MODKEY Mod4Mask  // Use Super key

static const char *font_name = "JetBrains Mono:pixelsize=14";
static int border_size = 2;
static const char *active_border_color = "darkgray";
static const char *inactive_border_color = "khaki";

static Shortcut shortcuts[] = {
    { MODKEY,               XK_Return,                "alacritty" },
    { MODKEY,               XK_d,                     "rofi -show drun" },
    { MODKEY,               XK_w,                     "firefox" },
    { MODKEY,               XK_e,                     "thunar" },
    { 0,                    XF86XK_AudioLowerVolume,  "pactl set-sink-volume @DEFAULT_SINK@ -5%" },
    { 0,                    XF86XK_AudioRaiseVolume,  "pactl set-sink-volume @DEFAULT_SINK@ +5%" },
};

static Keybinds keybinds[] = {
    // Movement
    { MODKEY,               XK_h,       move_window_x,       { .i = -50 } },
    { MODKEY,               XK_l,       move_window_x,       { .i = +50 } },
    { MODKEY,               XK_j,       move_window_y,       { .i = +50 } },
    { MODKEY,               XK_k,       move_window_y,       { .i = -50 } },
    
    // Resizing
    { MODKEY | ShiftMask,   XK_h,       resize_window_x,     { .i = -50 } },
    { MODKEY | ShiftMask,   XK_l,       resize_window_x,     { .i = +50 } },
    { MODKEY | ShiftMask,   XK_j,       resize_window_y,     { .i = +50 } },
    { MODKEY | ShiftMask,   XK_k,       resize_window_y,     { .i = -50 } },
    
    // Desktops
    { MODKEY,               XK_1,       switch_to_desktop,   { .i = 1 } },
    { MODKEY,               XK_2,       switch_to_desktop,   { .i = 2 } },
    { MODKEY,               XK_3,       switch_to_desktop,   { .i = 3 } },
    { MODKEY,               XK_4,       switch_to_desktop,   { .i = 4 } },
    
    // Window control
    { MODKEY,               XK_f,       fullscreen,          { 0 } },
    { MODKEY,               XK_q,       kill_window,         { 0 } },
    { MODKEY,               XK_x,       window_hmaximize,    { 0 } },
    { MODKEY,               XK_z,       window_vmaximize,    { 0 } },
};
```

## Function Reference

| Function | Category | Parameters | Description |
|----------|----------|------------|-------------|
| `move_window_x` | Movement | `arg->i` (pixels) | Move window horizontally (positive = right) |
| `move_window_y` | Movement | `arg->i` (pixels) | Move window vertically (positive = down) |
| `resize_window_x` | Resize | `arg->i` (pixels) | Resize window width (positive = wider) |
| `resize_window_y` | Resize | `arg->i` (pixels) | Resize window height (positive = taller) |
| `switch_to_desktop` | Desktop | `arg->i` (desktop #) | Switch to specified desktop |
| `move_to_desktop` | Desktop | `arg->i` (desktop #) | Move window to specified desktop |
| `kill_window` | Control | None | Force kill active window |
| `fullscreen` | Control | None | Toggle fullscreen mode |
| `window_vmaximize` | Maximize | None | Toggle vertical maximize (full height) |
| `window_hmaximize` | Maximize | None | Toggle horizontal maximize (full width) |
| `window_snap_up` | Snap | None | Snap window to top edge |
| `window_snap_down` | Snap | None | Snap window to bottom edge |
| `window_snap_left` | Snap | None | Snap window to left edge |
| `window_snap_right` | Snap | None | Snap window to right edge |

### Getting Help

- Check the source code comments for implementation details
- Use `xev` to debug key binding issues
- Use `xwininfo` to inspect window properties
- Check X11 logs in `/var/log/Xorg.0.log`

## Inspiration

- https://www.youtube.com/watch?v=JZcMLjnm1ps
- https://wumbo.net/symbols/plus-minus/
- https://cvsweb.openbsd.org/xenocara/app/cwm/
- https://st.suckless.org/
